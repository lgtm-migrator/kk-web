---
slug: "/blog/20200711"
date: "2020-07-11"
title: "Redux × api"
---

Redux を使用する場合、多くのケースでは Api 周りをなんとかしたいという気持ちがあると思います。

自分は結構 redux-saga 信者なので ジェネレーター構文ばかり書くのですが。

メジャーどころのパッケージは何なんだろうとふと思い、調べてみました。

---

現状の Redux で api を扱うケースでは、以下の 4 つがメジャーなのかなぁと勝手に思っています。

- [redux-thunk](https://github.com/reduxjs/redux-thunk)
- [redux-promise-middleware](https://github.com/pburtchaell/redux-promise-middleware)
- [redux-saga](https://github.com/redux-saga/redux-saga)
- [redux-observable](https://github.com/redux-observable/redux-observable)

知名度順としては、`redux-thunk` >> `redux-saga` > `redux-observable` >> `redux-promise-middleware`な印象です。

ちなみに[npm trends](https://www.npmtrends.com/redux-observable-vs-redux-saga-vs-redux-thunk-vs-redux-promise-middleware)ではこんな感じです。

各パッケージについて、個人的な印象とメリットデメリットを書いていこうと思います。

---

## redux-thunk

Redux で Api を扱うといえばまずはこれ、と言われるくらい有名なパッケージ。

Container で Api を読んで、取得した結果を action の引数に乗せて Store を更新します。

### redux-thunk のメリット

とにかくシンプル、Redux 本来の形をそのまま維持できます。

コーディング難易度は低く、素直に書ける印象があります。

### redux-thunk のデメリット

Container に Api 周りのロジックが乗るため、Redux の良さが感じづらい印象があります。

事実、過去に『そもそもなんで Redux を使う必要があるんですか？』と聞かれたこともあります。

4 つの方法の中では最も Container が肥大化するやり方です。

また、過去 Api を記述したファイルで action を dispatch するみたいなとんでもないプロジェクトもあったりしたので、きちんと理解してから書く必要があります。

## redux-promise-middleware

Action に Api を乗っけちゃえばええやんという、大胆なやり方です。

## redux-promise-middleware のメリット

Action が肥大化するに留まるので、Container はスッキリします。

Redux の概念外のファイルの生成が行われないため、構成もスッキリします。

## redux-promise-middleware のデメリット

Action が肥大化かつ複雑化し、本来の Action の概念からはズレます。

また、Action にルールを持たせるのが結構難しそうです。

あとかなりマイナーな部類なので、周辺パッケージがサポートしていないケースもあるかも？

## redux-saga

Redux に Saga の概念を持ち込み、Saga で Api 周りを解決してやろうというパッケージです。

### redux-saga のメリット

大規模な開発に耐えうる強固なプロジェクト開発が可能です。

Saga でのカスタマイズ性も高く、結構なんでもできちゃいます。

redux-promise-middleware 同様、Container はかなりスッキリします。

### redux-saga のデメリット

カスタマイズ性が高いため、基本的に Saga はシンプルに構成する認識を持たないとすぐにプロジェクトが破綻します。

またコーディング量は最も多く、結構大変です。

Redux の概念から外れた Saga を導入するため、Redux 以上の理解が求められます。

あと、ジェネレーター構文を使用している関係で、型周りのサポートが少し弱い印象があります。

## redux-observable

Redux に Epic の概念を持ち込み、Api 周りを rxjs の力で解決してやろうというパッケージです。

知名度の割にあまり使われていないパッケージです。

### redux-observable のメリット

redux-saga 同様、大規模な開発に耐えうる強固なプロジェクト開発が可能です。

Epic によるカスタマイズ性も高く、これまた結構なんでもできちゃいます。

### redux-observable のデメリット

とかく開発難易度が高いです、rxjs が難しすぎる…。

Angular を書き慣れている人であればスイスイ書けるんですかね？

ただ、Angular がかなり下火ということもあり、付随する rxjs も下火感はかなり強いです。

その割に redux-saga と同様のデメリットを持つため、選択肢としては挙がらない印象です。

---

個人的には、やはり Redux 本来の形を崩したくないのと強固なプロジェクト作りが好きなので、やっぱり `redux-saga` かなぁと。

メジャーどころですし、型周りをフォローしてくれるパッケージも多いのであまり悩まず書けます。

そこまでしっかりした開発を求めていない人は `redux-promise-middleware` あたりは悪くないと思います。

ただ、Action 周りの型のフォローがどれくらい効くのかわかっていないので、そこはちょっと心配ですね。

個人的には小規模な開発であっても`redux-saga`を推しますね。

一方、`redux-thunk`と`redux-observable`はあまりおすすめできないです。

簡単な Web サービスなら耐えうると思いますが、`redux-thunk`では Container に Api 周りのロジックが乗っかるため、少しでも肥大化を抑えたい考え方と真っ向からぶつかってくるのがなんともです。

また、`redux-observable`は`redux-saga`のメリットを薄くし、デメリットを強くした感じのパッケージなため、そもそも選択肢に挙がらないかなぁと。

かなり古いのですが、同じ比較をしている記事があったので参考までに。

[Redux 4 Ways](https://medium.com/react-native-training/redux-4-ways-95a130da0cdc)

同じような結論に至っていますが、`redux-thunk`に触れてすらいないのが面白いなぁと。
